<div class="p-6">
  <p-card>
    <ng-template pTemplate="header">
      <div class="p-4">
        <h3 class="text-lg font-semibold">Lista de Usuarios</h3>
      </div>
    </ng-template>

    <ng-template pTemplate="content">
      @if (error()) {
      <div
        class="mb-4 p-4 rounded-lg"
        style="background-color: var(--red-50); border: 1px solid var(--red-200)"
      >
        <div class="flex items-center">
          <i class="pi pi-exclamation-triangle mr-2" style="color: var(--red-500)"></i>
          <span style="color: var(--red-700)">{{ error() }}</span>
        </div>
      </div>
      }

      <p-table
        [value]="usuarios()"
        [loading]="loading()"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 25, 50]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} usuarios"
        [globalFilterFields]="['usuario', 'perfiles']"
        responsiveLayout="scroll"
        styleClass="p-datatable-striped"
      >
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="id" class="font-semibold">
              ID <p-sortIcon field="id"></p-sortIcon>
            </th>
            <th pSortableColumn="usuario" class="font-semibold">
              Usuario <p-sortIcon field="usuario"></p-sortIcon>
            </th>
            <th class="font-semibold">Perfil</th>
          </tr>
          <tr>
            <th>
              <p-columnFilter type="text" field="id" placeholder="Buscar ID"></p-columnFilter>
            </th>
            <th>
              <p-columnFilter
                type="text"
                field="usuario"
                placeholder="Buscar usuario"
              ></p-columnFilter>
            </th>
            <th>
              <p-columnFilter
                type="text"
                field="perfiles"
                placeholder="Buscar perfil"
              ></p-columnFilter>
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-usuario>
          <tr>
            <td>{{ usuario.id }}</td>
            <td>{{ usuario.usuario }}</td>
            <td>
              @if (usuario.perfiles && usuario.perfiles.length > 0) {
              <span class="inline-flex items-center gap-1">
                @for (perfil of usuario.perfiles; track $index; let isLast = $last) {
                <span
                  class="px-2 py-1 text-xs rounded"
                  style="background-color: var(--primary-100); color: var(--primary-800)"
                >
                  {{ perfil }}{{ !isLast ? ',' : '' }}
                </span>
                }
              </span>
              } @if (!usuario.perfiles || usuario.perfiles.length === 0) {
              <span> Sin perfil asignado </span>
              }
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="3" class="text-center py-8">
              <i class="pi pi-users text-4xl mb-4 block"></i>
              No se encontraron usuarios
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="3" class="text-center py-8">
              <i
                class="pi pi-spin pi-spinner text-3xl mb-2"
                style="color: var(--primary-color)"
              ></i>
              <p>Cargando usuarios...</p>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </ng-template>
  </p-card>
</div>
